# Network Switching - Configure DAI and IPSG (with DHCP Snooping)

## Dynamic ARP Inspection (DAI)
+ A **layer 2** security fgeature that protects a network from MitM attacks (e.g. ARP Spoofing or ARP cache poisoning).
+ DAI inspects incoming ARP requests and responses and compares them to the IP-to-MAC address bindings against a trusted database (MAC address, IP address, and VLAN interface) built using DHCP snooping.
+ If the packet's binding is invalid (mismatch of IP-MAC address association against known combinations), the packet is dropped, preventing the attacker from misdirecting network traffic and impersonating devices.
+ _Trusted Ports_: ARP packets arriving on these ports (e.g. connected to trusted switches) are forwarded without inspection because they are assumed to be part of the trusted network.

## IP Source Guard (IPSG)
+ A security feature that filters traffic on untrusted **layer 2** ports by inspecting IP source addresses.
+ AIM: Prevent malicious hosts from spoofing their IP addresses by verifying the IP and MAC address combinations of incoming packets against a binding table created by DHCP snooping ro static configuration.
+ Without it, an attacker can spoof the IP address of a legitimate hosts to gain unauthorised access or perform malicious actions.
+ When IPSG is enabled, after a host gets an IP address from a DHCP server (or static mapping), IPSG allows traffic only if the source IP (and optional MAC) address matches an entry in the binding table.

### Tasks
1. Create VLAN topology in Packet Tracer & Basic Router/Switch Configuration
2. Config DHCP Snooping on the Switch
3. Enable IP ARP Inspection on current vlan in use
4. Config trusted ports for IP ARP inspection
5. Config IP verify source for trusted ports.

#### Step 1 - Basic Router, Switch, and Server Config
**Legitimate DHCP Server**
IPv4 Add: 10.10.10.40/255.255.255.0
Default Gateway 10.10.10.1


**Rogue DHCP Server**
IPv4 Add: 10.10.10.40/255.255.255.0
Default Gateway 10.10.10.1

**Router 0**
! Basic Config
conf t
hostname R0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name domain.com
ip add 10.10.10.1 255.255.255.0
no shut

do wr

**Switch 0**
! Basic Config
conf t
hostname SW0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name domain.com

do wr

#### Step 2 - Config DHCP Snooping
**Switch 0**
!Global Config Mode
ip dhcp snooping

int range g0/1,f0/24
ip dhcp snooping trust
exit 
! Global Config Mode

do wr

ip dhcp snooping vlan 1

do wr
! View configured trusted DHCP VLANS, interfaces/ports
do sh ip dhcp snooping

#### Step 3 - Enable ARP Inspection on current VLAN
**Switch 0**
conf t
ip arp inspection vlan 1

do wr

#### Step 4 - Config Trusted Ports ARP Inspection
_Trusted Ports on SW0_
Gig0/1, Fa0/24

!Global Config Mode
int range g0/1,f0/24
ip arp inspection trust

do wr

exit

! View IP ARP Inspection interfaces
do sh ip arp inspection int

#### Step 5 - Config Verify IP Source for Trusted Ports (Does not work in Packet Tracer)
!Global Config Mode 
int range g0/1,f0/24
ip verify source