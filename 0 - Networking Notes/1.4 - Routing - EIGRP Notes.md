# Routing - Enhanced Interior Gateway Routing Protocol (EIGRP) Notes

**NOTE**: 
+ Refer to [0.0 Routing - Concepts & Notes](0.0 -  Routing - Concepts and Notes.md)

## EIGRP Summary
+ **How it Works?**
	- Type: Advanced Distance Vector (Cisco Proprietary, now open standard).
	- Operation: Uses Diffusing Update Algorithm (DUAL) to ensure loop-free and rapid convergence.
	- Exchanges partial updates only when topology changes.
+ **Key Features**
	- Supports unequal-cost load balancing.
	- Fast convergence.
	- Scalable and reliable (uses neighbour relationships and feasible successors).
	- Supports multiple network protocols (IPv4, IPv6, IPX, AppleTalk).
+ **Metrics**
	- Metric: Composite (Bandwidth, Delay, Reliability, Load, MTU).
	- Default Formula: ```Metric = [ (10^7 / Min Bandwidth) + Sum of Delays ] Ã— 256```
+ **Drawbacks**
	- More complex tuning and troubleshooting than RIP.
+ **Applicable Use Cases**
	- Cisco-dominant enterprise networks needing fast convergence and flexibility.

## Routing Enhanced Interior Gateway Routing Protocol (EIGRP) Notes
+ EIGRP is a dynamic routing (distance vector) protocol that is used to find the best path between any two-layer 3 (Network Layer) devices to deliver the packet and sharing routing information between routers.
+ EIGRP is an improvement over the earlier protocol IGRP.

## EIGRP Features
+ **Better Convergence**: How quickly a routing protocol can adapt to network topology changes & find the best path for packets. EIGRP uses the Diffusing Update Algorithm (DUAL) to achieve fast convergence times.
+ **Less Bandwidth**: EIGRP uses less bandwidth by sending only partial updates which minimises the amount of data it has to send.
+ **Supports Multiple Network Layer Protocols**: Supports different protocols and can route IP, IPX, and AppleTalk.
+ **IGRP, IPv4, and IPv6 Compatible** 

## How EIGRP Works?
+ EIGRP has 4 basic components:
	- **Neighbor Discovery/Recovery**: Routers also discover when neighbouring routers become unreachable by sending low overhead _hello_ packets; if receiveed the router is assumed to be operational.
	- **Reliable Transport Protocol**: Is responsible for guaranteed, ordered delivery of EIGRP packets to all neighbors. It also has a provision to send multicast packets quickly when there are unacknowledged packets pending; thus keeping covergence time low for varying speed links.
	- **DUAL Finite State Machine**: 
		- Responsible for the decision process for all route computations, tracking all routes advertised. Distance is used by DUAL to select efficient loop free paths.
		- DUAL selects routes to be inserted into a routing table based on feasible successors - a neighbouring router used for packet forwarding that has a least cost path to a destination that is guaranteed not to be part of a routing loop. 
		- The amount of time it takes to recompute the route affects the convergence time. 
		- Even though the recomputation is not processor-intensive, it is advantageous to avoid recomputation if it is not necessary.
	- **Protocol Dependent Modules**: Are responsible for network layer, protocol-specific requirements, e.g., he IP-EIGRP module is responsible for sending and receiving EIGRP packets that are encapsulated in IP.
## EIGRP Metric Calculation
+ EIGRP calculates a composite metric using bandwidth, delay, reliability, and load, combined with 5 configurable K-values, but only 2 are used by default (K1 and K3).
	- K1 (bandwidth) 
	- K2 (load) 
	- K3 (delay) 
	- K4 & K5 (reliability) 

```
EIGRP metric: 256 * { K1*BW + [(K2*BW)/(256-load)] + (K3*delay) } * { K5/(reliability+K4) }
```

## EIGRP Concepts
### Neighbor Table
+ Each router keeps state information about adjacent neighbors; stored in the neighbor data structure/table.
+ The address and interface of newly discovered neighbours are recorded.
+ If a neighbour router sends a hello, it advertises a HoldTime - the amount of time a router treats its neighbour as reachable & operational.
+ If the HoldTime expires, DUAL is informed of the topology change.
+ The neighbor table entry also includes information required by the reliable transport mechanism; sequence numbers are used to match acknowledgement with data packets to detect out-of-order packets.

### Topology Table
+ Contains all destinations advertised by neighouring routers.
+ Each entry includes the destination address and a list of neighbours that have advertised the destination, and advertised metric recorded.
+ Also associated with the destination is the metric that the router uses to reach the destination; a sum of the best advertised metric from all neighbours plus the link cost to the neighbour.
+ This is the metric that the router uses in the routing table and to advertise to other routers.

### Feasible Successors
+ A destination entry is moved from the topology table to the routing table when there is a feasible successor.
+ All minimum cost paths to the destination form a set; from the set, neighbours that advertised a metric less than the current routing table metric are considered feasible successors.
+ If a neighbor changes the metric it has been advertising or a topology change occurs in the network, the set of feasible successors have to be re-evaluated; btu this is not categorised as a route recomputation.

### Route States
+ A topology table entry for a destination can have one of two states:
	- Passsive: a router is not performing a route recomputation.
	- Actve: a router is performing a route recomputation.
+ If there are no feasible successors, a route goes into Active state & route recomputation occurs, by sending a query packet to all neighbours.
+ Neighbouring routers can either reply if they have feasible successors for the destination or return a query inddicating they are performing a route recommputation (optional).
+ If in Active state, a router cannot change the next-hop neighbor it is using to forward packets; but  after all replies are recived for a query, the destination can transition to Passive and a new successor selected.
+ If a link to a neighbor that is the only feasible successor goes down, all routes through that neighbor commence a route recomputation and enter the Active state.

### Packet Formats
+ EIGRP uses messages  to communicate with neighbouring EIGRP devices:
	- **hello** message:
		* Keep alive messages exchanged between 2 EIGRP devices and used for discover/recovery.
		* If multicast at 224.0.0.10, they are used for neighbour discovery.
		* Used as acknowledgement, when unicast.
		* A hello with no data is used as the acknowledgement.
	- **null** update:
		* Used to calculate SRTT(Smooth Round Trip Timer) and RTO(Retransmission Time Out).
		* SRTT - time taken by a packet to reach the neighbouring router & acknowledgment of the return packet.
		* RTO - time the local router waits for a packet acknowledgement; if multicast fails then unicast is used to that router. 
	- **full** update: message contains all the best routes, and is exchanged after exchanging hello messages or after the neighbourship is formed.
	- **partial** update: messages are multicast, and are exchanged when a topology changes or new links are added.
	- **query** message: messages are multicast when the device is declared dead and it has not routes to it in its topology table.
	- **reply** message: messages are the acknowledgment of the query message sent to the originator of the query message stating the route to the network which has been asked in the query message.
	- **acknowledgement** message: hello packets that contain no data; used used to acknowledge EIGRP updates, queries, and replies.
+ **NOTE**:
	- Hello and acknowledgment packets do not require any acknowledgment. 
	- Reply, query, update messages are reliable messages i.e require acknowledgement.
### Route Tagging
+ EIGRP supports:
	- Internal Routes - routes originated within an EIGRP autonomous system (AS); a directly attached network configured to run EIGRP is considered an internal route.
	- External ROutes - routes learned by another routing protocol or reside in the routing table as static routes.
+ External routes are tagged with the following information:
	- The router ID of the EIGRP router that redistributed the route.
	- The AS number where the destination resides.
	- A configurable administrator tag.
	- Protocol ID of the external protocol.
	- The metric from the external protocol.
	- Bit flags for default routing.

## Additional Resources & Information
+ [EIGRP Fundamentals](https://www.geeksforgeeks.org/computer-networks/eigrp-fundamentals/)
+ [Introduction to EIGRP](https://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/13669-1.html)
+ [CBT Nuggets - What is EIGRP?](https://www.cbtnuggets.com/blog/technology/networking/what-is-eigrp)
+ [EIGRP Metric](https://www.practicalnetworking.net/stand-alone/eigrp-metric/)
