# Cisco Switch Secure Configuration

## Cisco Switchports
+ A network switch can have its ports configured as _trunk_ or _access_.
	+ _access_ mode: 
		+ Connects endpoint devices (PCs, printers, phones) to the network.
		+ Carries traffic for only one VLAN.
		+ Removes 802.1Q tags from incoming traffic and adds them to outgoing traffic if a voice VLAN is configured (else no tagging).
	+ _trunk_ mode: 
		+ Links network devices like switches and routers, allowing them to share multiple VLANs over a single connection.
		+ Carries traffic for multiple VLANs simultaneously.
		+ Uses 802.1Q encapsulation to add VLAN tags to frames, identifying which VLAN each frame belongs to.
+ _Native VLAN_: A special, trunk-port-specific VLAN on an 802.1Q link that carries untagged traffic.
+ [Key Differences Between Trunk and Access Ports](https://www.nice.com/info/trunk-network-explained-key-differences-between-trunk-and-access-ports)

## Secure Switch Configuration Baseline
### Basic Identify & Access Control
! Access Global Config
! Configure hostname (Descriptive Name eg SW1 or sw-dept or sw-fl3) - amend accordingly
! Secure Privilege EXEC mode with encrypted password
! Encrypt all plaintext passwords
! Disable DNS lookups
! Legal Banner

en 
config t 
hostname SW1 
enable secret <StrongPassword> 
service password-encryption 
no ip domain-lookup 
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^


### User Authentication
! Global Config Mode: create local user with encrypted password
! Line Config Mode: login via local user account, set timeout to 5 minutes, & synchronise logs with prompts
! Line Config Mode
! Secure remote access: disable Telnet, enforce SSH only, and apply timeouts

username admin sec <StrongPassword>
line con 0 
line vty 0 15 
login local 
transport input ssh 
exec-timeout 5 0 
logg syn


### SSH Secure Access
! Global Config Mode
! Enable SSH with 2048-bit keys, set domain (for key generation), and force SSHv2
! Timeout authentication process (default 120)

do config t 
ip domain-name domain.com 
crypto key generate rsa general-keys modulus 1024 
ip ssh version 2 
ip ssh time-out 60


### Management Security
! Line Config Mode
! Assign a management IP to VLAN 1
! Define default gateway for remote management
! Disable Cisco Discovery Protocol (CDP); prevent device info leakage
! Ensure idle TCP sessions are automatically closed (resource mgt & prevent session hijack/exploit) - NOT required on newer devices?
! service tcp-keepalives-in
! service tcp-keepalives-out

do config t 
ip domain-name domain.com 
crypto key generate rsa general-keys modulus 1024 
ip ssh version 2 
ip ssh time-out 60


### Port Security and Layer 2 Protection
! Global and Interface Config Mode
! Force access mode, enable port security (restrict to 2 MACs/port), sticky MAC learning
! Protect gainst CAM/MAC flooding, and prevent rogue switch attachs (BPDU guard)
! Recover ports disabled by BPDU Guard after 5 mins
! errdisable recovery cause bpduguard  (Not supported on 2960)
! errdisable recovery interval 300  (Not supported on 2960)

int range f0/1-24 
switchport mode access 
switchport port-security 
switchport port-security maximum 2 
switchport port-security violation restrict 
switchport port-security mac-address sticky 
spanning-tree portfast 
spanning-tree bpduguard enable 

### Logging and Monitoring ************
! User EXEC Mode
! Show current clock settings
! Set the correct date/time before proceeding
! Store logs in buffer and timestamp with precision

exit
sh clock
logging buffered 16384 
service timestamps log datetime msec



! Enable config change logging
`conf t`
! Archive config mode
`SW(config)#` `archive`
! Configuration Change Logger Mode
`SW(config-archive)#` `log config`
! Enable config change logging
`SW(config-log-config)#` `logging enable` 
! Send config changes to IOS syslog process
`SW(config-log-config)#` `notify syslog`
! Suppress password info from displaying in config log file
`SW(config-log-config)#` `hidekeys`
! Verify config change logging
`SW#` `sh archive log config all` 

! Set SNMP community string (read-only) for monitoring (needs research)
`SW(config)#` `snmp-server community <SECURE_STRING> RO`

### Save Config
`en`
`wr`




no service pad
no service finger
no ip source-route
no ip gratuitous-arps
no service dhcp (only on devices that don't offer DHCP relay or addresses)
no ip finger
no tcp-small-servers (IOS 11.2 and older)
no udp-small-servers (IOS 11.2 and older)

!logging timestamps helps you correlate events across network devices
service timestamps debug datetime msec localtime
service timestamps log datetime msec localtime
service sequence-numbers
service counters max age 5
service password-encryption
service linenumber
service counters max age 5


## Secure Basic Switch Configuration
+ The commands below can be copied and pasted directly into a switch's CLI to provide secure remote SSH access.
+ In addition, the physical Console line is secured and only remote SSH access is permitted.
+ **NB**: Replace the various variables below with the suitable strong passwords.
+ Additional Security:
	+ Apply ACL to limit SSH access to specific IP/VLAN.
	+ Disable ports not in use.
	+ Port Security (MAC Address Lockin)
	+ DHCP Snooping


! Configuration Starts Here
en
conf t
hostname SW0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^

! Secure Priveleged Exec Mode 
enable password <password>

! Disable domain lookup (prevent DNS lookups)
no ip domain-lookup

! Set IP Domain Name
ip domain-name [domain.com]

!Set Username and Password (Remote Access - Local DB)
username admin password <password>

! Encrypt all passwords
service password-encryption

! Set Clock Time (return to priv exec mode R1#)
exit
clock set 15:30:00 22 August 2025

! Enable Line Console Password
conf t
line con 0
password <password>
login local
exec-timeout 3 0
logg syn
exit


!Set Username and Password (Remote Access)
username admin password <password>

! Encrypt all passwords
service password-encryption

! Set Clock Time (return to priv exec mode SW#)
clock set [15:30:00 22 August 2025]

! Set Management IP Add
int vlan 1
description management vlan
ip add [192.168.1.254] [255.255.255.0]
no sh
! Set Default Gateway (return to global config mode)
exit 
ip default-gateway [192.168.1.1] 

! Enable SSH with 1024-bit keys, set domain (for key generation), and force SSHv2
! Timeout authentication process (default 120)

crypto key generate rsa general-keys modulus 1024 
ip ssh version 2 
ip ssh time-out 60

! Config VTY SSH Access
line vty 0 15
! Specify authentication based on local db
login local
! Only permit SSH (no Telnet)
transport input ssh
exit

! Copy Running Config to Startup Config
do wr

! ACL for SSH VTY Access 
! Create Standard Numbered ACL list to allow PC host IP access
access-list 10 permit host [192.168.1.10]
access-list 10 deny any
! Bind the ACL to VTY 
line vty 0 15
! Allow incoming traffic on access-list 10
access-class 10 in
exit


! Copy Running Config to Startup Config
do wr

! Disable Unused ports
vlan 999
name blackhole
int range f0/6-24,g0/1-2
switchport mode access
switchport access vlan 999
shutdown
exit

! Copy Running Config to Startup Config
do wr

! Switchport Security Config
int range f0/1-5
int range f0/1-2
switchport mode access
switchport port-security
! Limit port to two MAC Address (e.g., IP Phone/PC)
switchport port-security maximum 2
! Define the mac address permitted to access the port/interface
! Switch 'learns' MAC Addresses
switchport port-security mac-address sticky
! Switchport remains active, but traffic dropped
switchport port-security violation protect

! Copy Running Config to Startup Config
do wr