# Routing - Host Standby Router Protocol (HSRP) Configuration

![HSRP Topology](3.28-Routing-HSRP-Config.png)

## HSRP Summary

+ A redundancy protocol that creates a fault-tolerant default gateway.
+ It allows a group of routers to work together by presenting a single virtual IP address and virtual MAC address that acts as the default gateway. 
One router in the group is designated the "active" router to forward traffic, while another is the "standby" router ready to take over if the active router fails.
+ **Virtual IP Address**: A shared IP address configured on all routers in the group that hosts use as their default gateway.
+ **Virtual MAC Address**: A shared MAC address that corresponds to the virtual IP address. 
+ **Group number**: A number that identifies a specific HSRP group, used to ensure routers are on the same standby group. 
+ **Priority**: A value from 1 to 255 that determines which router is elected active (higher number wins). The default is 100.
+ **Failover**: 
	- The routers exchange periodic hello messages. If the active router fails, it stops sending hello messages. 
	- The standby router will wait for a configured "holdtime" to expire before taking over the virtual IP and MAC addresses, becoming the new active router. 
+ **Preemption**: A feature called "preempt" allows a router to automatically take back the active role if its priority is higher than the current active router, ensuring the highest-priority router is always active. 
+ **Versions**: HSRPv1 and HSRPv2. Version 2 is not backward-compatible with version 1 and offers a larger range of group numbers. 

## Scenario

+ Two sites - Site A and B, need to communicate with each other.
+ Site A requires additional redundancy which is achieved by using an additional router (total 2 routers) and configuring HSRP.
+ The inclusion of routers will require configuring atleast one routing protocol - OSPF.

## Tasks

1. Create VLAN topology in Packet Tracer & Router/Switch/PCs Configuration.
2. Config Router IP and HSRP parameters
3. Config hosts and make Site A network use the virtual router as the default gateway.
4. Config OSPF to advertise routes
5. Ping and traceroute from Site A to B
6. Disconnect Active R0 from Site A
7. Ping and traceroute from Site A to B (to confirm redundancy)




## Configuration Commands

### Task 1 + 3 - Router, Switch, and PC Basic Config

**Switch 0**
```
! Basic Config
conf t
hostname SW0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name cybersec.com

do wr
```

**Switch 1**
```
! Basic Config
en
conf t
hostname SW1
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name cybersec.com

do wr
```

**L3SW0**
+ Interfaces Gig1/0/1-2 will be configured for HSRP
```
! Basic Config
en
conf t
hostname L3SW0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name cisco.com

do wr
```

**Router 0 (ACTIVE)**
```
! Basic Config
en
conf t
hostname R0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name cybersec.com

!Interface Config
int g0/0
description Link to SITE B R2
ip add 10.10.10.1 255.255.255.252
no sh
exit
! int g0/2 HSRP Config

do wr
```

**Router 1 (STDBY)**
```
! Basic Config
en
conf t
hostname R1
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name cybersec.com

!Interface Config
int g0/2
description Link to SITE B R2
ip add 10.10.10.5 255.255.255.252
no sh
exit
! int g0/1 HSRP Config

do wr
```

**Router 2**
```
! Basic Config
en
conf t
hostname R2
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name cybersec.com

!Interface Config
int g0/0
description Link to R0
ip add 10.10.10.2 255.255.255.252
no sh
exit
int g0/1
description Link to SITE B
ip add 192.168.2.1 255.255.255.0
no sh
exit
int g0/2
description Link to R1
ip add 10.10.10.6 255.255.255.252
no sh
exit


do wr
```

### Task 2 - Config Router IP and HSRP parameters
+ Active router needs to take the highest IP address (higher numerical value versus the standby router).
+ **Note**: Since the default gateway IP address is 192.168.1.1, router R0 and R1 must be assigned different IP addresses.
+ Routers assigned to HSRP group No. 20. 

**Router 0 (ACTIVE)**
```
int g0/2
ip add 192.168.1.3 255.255.255.0
standby 20 priority 100
standby 20 ip 192.168.1.1
no sh
exit

do wr

! View HSRP Status/Config
do sh standby br
```
+ CLI displayer after configuration.
```
%HSRP-6-STATECHANGE: GigabitEthernet0/2 Grp 20 state Speak -> Standby

%HSRP-6-STATECHANGE: GigabitEthernet0/2 Grp 20 state Standby -> Active

R0(config)#do sh standby br
                     P indicates configured to preempt.
                     |
Interface   Grp  Pri P State    Active          Standby         Virtual IP
Gig0/2      20   100   Active   local           192.168.1.2     192.168.1.1  
```

**Router 1 (STDBY)**
```
int g0/1
ip add 192.168.1.2 255.255.255.0
standby 20 priority 90
standby 20 ip 192.168.1.1
no sh
exit

do wr

! View HSRP Status/Config
do sh standby br

```
+ CLI displayer after configuration.
```
%HSRP-6-STATECHANGE: GigabitEthernet0/1 Grp 20 state Speak -> Standby

%HSRP-6-STATECHANGE: GigabitEthernet0/1 Grp 20 state Standby -> Active

%HSRP-6-STATECHANGE: GigabitEthernet0/1 Grp 20 state Speak -> Standby

R1(config)#do sh standby br
                     P indicates configured to preempt.
                     |
Interface   Grp  Pri P State    Active          Standby         Virtual IP
Gig0/1      20   90    Standby  192.168.1.3     local           192.168.1.1 
```

### Task 4 - Config OSPF
**Router 0 (ACTIVE)**
```
! Configure Process ID 20
router ospf 20

! Assign router ID 
router-id 1.1.1.1
network 192.168.1.0 0.0.0.255 area 0
network 10.10.10.0 0.0.0.3 area 0
exit

do wr

! View OSPF Config
do sh running-config | section router ospf

! View OSPF Neighbours
do sh ip ospf neighbor
```

**Router 1 (STDBY)**
```
! Configure Process ID 20
router ospf 20

! Assign router ID 
router-id 2.2.2.2
network 192.168.1.0 0.0.0.255 area 0
network 10.10.10.4 0.0.0.3 area 0
exit

do wr

! View OSPF Config
do sh running-config | section router ospf

! View OSPF Neighbours
do sh ip ospf neighbor
```


**Router 2**
```
! Configure Process ID 20
router ospf 20

! Assign router ID 
router-id 3.3.3.3
!advertise the direct connected networks
network 192.168.2.0 0.0.0.255 area 0
network 10.10.10.0 0.0.0.3 area 0
network 10.10.10.4 0.0.0.3 area 0
exit

do wr

! View OSPF Config
do sh running-config | section router ospf

! View OSPF Neighbours
do sh ip ospf neighbor
```


### Task 5 - Ping and traceroute from Site A to B
```
C:\>ping 192.168.2.2

Pinging 192.168.2.2 with 32 bytes of data:

Reply from 192.168.2.2: bytes=32 time<1ms TTL=126
Reply from 192.168.2.2: bytes=32 time<1ms TTL=126
Reply from 192.168.2.2: bytes=32 time=21ms TTL=126
Reply from 192.168.2.2: bytes=32 time<1ms TTL=126

Ping statistics for 192.168.2.2:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 21ms, Average = 5ms

C:\>tracert 192.168.2.2

Tracing route to 192.168.2.2 over a maximum of 30 hops: 

  1   0 ms      0 ms      0 ms      192.168.1.3
  2   0 ms      0 ms      0 ms      10.10.10.6
  3   0 ms      0 ms      0 ms      192.168.2.2

Trace complete.
```

### Task 6 - Disconnect Active R0 from Site A
**Router 0 (ACTIVE)**
```
R0(config)#int g0/2
R0(config-if)#shutdown
```

### Task 7 - Ping and traceroute from Site A to B (ACTIVE Router disconnected)

+ Ping and Traceroute Results
```
C:\>ping 192.168.2.2

Pinging 192.168.2.2 with 32 bytes of data:

Reply from 192.168.2.2: bytes=32 time<1ms TTL=126
Reply from 192.168.2.2: bytes=32 time<1ms TTL=126
Reply from 192.168.2.2: bytes=32 time<1ms TTL=126
Reply from 192.168.2.2: bytes=32 time=1ms TTL=126

Ping statistics for 192.168.2.2:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 1ms, Average = 0ms

C:\>tracert 192.168.2.2

Tracing route to 192.168.2.2 over a maximum of 30 hops: 

  1   0 ms      0 ms      0 ms      192.168.1.2
  2   0 ms      0 ms      0 ms      10.10.10.6
  3   0 ms      0 ms      0 ms      192.168.2.2

Trace complete.
```
+ **Note**: Once R0 is reconnected back to the network, it resumes its role as primary/active router via HSRP.