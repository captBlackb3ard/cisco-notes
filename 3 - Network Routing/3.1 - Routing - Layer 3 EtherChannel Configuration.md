# Routing - Multilayer Switch & Layer 3 EtherChannel

## EtherChannel
+ **EtherChannel**: 
	+ Cisco's implementation of link aggregation - bundling multiple physical Ethernet links into a single, logical high-speed link.
	+ Maximum of 8 links can be aggregated together to form a single link.

+ **Requirements**: all ports should have:
	+ Same duplex
	+ Same speed
	+ Same VLAN config (native VLAN and allowed VLAN should be the same)
	+ Switch port modes should be same (access or trunk mode)
### Port Aggregation Protocol (PAGP)
+ **PAGP**: semi-manual EtherChannel negotiation and configuration that supports 4 interface configuration modes:
	+ *ON*: The interface will be a part of EtherChannel but no negotiation takes place.
	+ *Desirable*: The interface will continuously attempts to convert the interface of the other switch into an EtherChannel. Supported EtherChannel combinations:
		+ Desirable - Desirable
		+ Desirable - Auto
		+ Auto - Desirable 
	+ *Auto*: The interface will become a part of EtherChannel if and only if it is requested by the opposite interface.
	+ *OFF*: No EtherChannel configured on the interface.

### Link Aggregration Control Protocol (LACP)
+ **LACP**: enables automatic aggregation of multiple physical ethernet ports/links into a single, high-bandwidth, logical channel known as *Port Channel* or *Link Aggregation Group*.
+ LACP Features include:
	+ Automatic Port Channel Creation: LACP exchanges control packets between Ethernet ports to automatically identify partners that support the standard and to form dynamic Port Channels. 
	+ Negotiation and Configuration: LACP enables ports to negotiate their capabilities, such as speed, duplex mode, and VLAN configuration, to ensure that only compatible ports are bundled into the same channel. 
	+ Maintaing Port Status: LACP maintains a dynamic link state for each aggregated port, ensuring that traffic is automatically redistributed over the remaining operational links if a port fails. 
	+ Prevent Packet Reordering and Duplication: LACP uses a Marker Protocol to ensure that all frames of a trafic flow are successfully received before traffic is redistributed across the newly adjusted channel.
+ LACP shares the same benefits as PAgP, but includes *Simplified Management*; it automatically configures and manages the aggregation of links.
+ LACP supports 4 different modes to configure the interfaces:
	+ _ON_: The interface will be part of the EtherChannel but no negotiation takes place.
	+ _Active_: Interface will continuously attempt to convert other side interface into an EtherChannel.
	+ _Passive_: Interface will become part of the EtherChannel if and only if it requested by the opposite side.
	+ _OFF_: No EtherChannel configured on the interface.
+ Supported EtherChannel combinations:
	+ Active - Active
	+ Active - Passive 
	+ Passive - Active

### Manual EtherChannel Configuraiton
+ Created using the EtherChannel mode _ON_; EtherChannel created when another interface group is also in EtherChannel _ON_ mode.
+ Interface will be part of the EtherChannel in this mdoe, without any negotiation protocol (LACP or PAgP).
+ Interfaces can be configured in 1 of 2 different modes:
	+ _ON_: Interface will be part of EtherChannel but no negotiation takes place.
	+ _OFF_: No EtherChannel configured on interface.

## Tasks
1. Create topology in Packet Tracer & Basic Switch/Endpoint Configuration.
2. Power on multilayer switches
3. Connect cables and enable IP routing on both the multilayer switches
4. Identify and configure L3 interfaces to be used (`no switchport`)
5. Config EtherChannel LACP/PAGP/ON protocols on the required ports
6. First, enter interface range, create a channel group and mode then assign IP to the port channel.
7. Display etherchannel parameters on the switches.

## Configuration Commands

### Task 1 & 3 - Enable IP Routing
**Switch 0**
```
! Basic Config
conf t
hostname SW0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
! Enable IP Routing
ip routing

do wr
```


**Switch 1**
```
! Basic Config
conf t
hostname SW1
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
! Enable IP Routing
ip routing

do wr
```

**Switch 2**
```
! Basic Config
conf t
hostname SW2
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
! Enable IP Routing
ip routing

do wr
```

### Task 4 - ID + Config L3 Interfaces
+ Channel Group 1:
	+ SW0: G1/0/20, G1/0/22, G1/0/24
	+ SW2: G1/0/20, G1/0/22, G1/0/24
+ Channel Group 2:
	+ SW0: G1/0/19, G1/0/21, G1/0/23
	+ SW1: G1/0/20, G1/0/22, G1/0/24
+ Channel Group 3:
	+ SW1: G1/0/19, G1/0/21, G1/0/23
	+ SW2: G1/0/19, G1/0/21, G1/0/23

**Switch 0**
```
int range g1/0/19-24
no switchport
exit

do wr
```

**Switch 1**
```
int range g1/0/19-24
no switchport
exit

do wr
```

**Switch 2**
```
int range g1/0/19-24
no switchport
exit

do wr
```

### Task 5, 6, & 7 - Config LACP/PAGP/ON protocols on the required ports

**_Channel Group 1 LACP_**
**Switch 0**
```
int range g1/0/20, g1/0/22, g1/0/24
! Config LACP Channel 1
channel-group 1 mode active
exit
int port-channel 1
ip add 10.10.1.254 255.255.255.0
no shut
exit
! Confirm etherchannel configurations
do sh etherchannel port 
```

**Switch 2**
```
int range g1/0/20, g1/0/22, g1/0/24
! Config LACP Channel 1
channel-group 1 mode passive
exit
int port-channel 1
ip add 10.10.1.253 255.255.255.0
no shut
exit
! Confirm etherchannel configurations
do sh etherchannel port 
```

**_Channel Group 2 PAGP_**
**Switch 0**
```
! Config PAgP Channel 2
int range g1/0/19, g1/0/21, g1/0/23
! Config PAgP Channel 2
channel-group 2 mode desirable
exit
int port-channel 2
ip add 10.10.2.254 255.255.255.0
exit
! Confirm etherchannel configurations
do sh etherchannel port 
```

**Switch 1**
```
! Config PAgP Channel 2
int range g1/0/20, g1/0/22, g1/0/24
! Config PAgP Channel 2
channel-group 2 mode auto
exit
int port-channel 2
ip add 10.10.2.253 255.255.255.0
exit
! Confirm etherchannel configurations
do sh etherchannel port 
```

**_Channel Group 3 Manual_**
**Switch 1**
```
! Config LACP Channel 3
int range g1/0/19, g1/0/21, g1/0/23
channel-group 3 mode on
exit
int port-channel 3
ip add 10.10.3.254 255.255.255.0
exit
! Confirm etherchannel configurations
do sh etherchannel port 
```

**Switch 2**
```
! Config LACP Channel 3
int range g1/0/19, g1/0/21, g1/0/23
channel-group 3 mode on
exit
int port-channel 3
ip add 10.10.3.253 255.255.255.0
exit
! Confirm etherchannel configurations
do sh etherchannel port 
```

**Note:** Write the configurations the start configuration and reload/reboot the switches to establish the etherchannels.