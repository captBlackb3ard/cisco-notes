# Routing - Configure Inter-VLAN Routing using Router-on-a-Stick (ROAS)

+ There are two methods to enable inter-vlan routing:
	- Router on a Stick
	- Switch Virtual Interfaces (SVI) using multilayer switches.

## Switch Virtual Interface (SVI)

+ A logical, software-based L3 interface associated with a specific VLAN, allowing a switch to act as a router to forward traffic between VLANs and provide IP host connectivity.

## Router-on-a-Stick

+ A network configuration that uses a single physical Ethernet link between a L2 switch and a router to enable inter-vlan routing (allow traffic from different VLANs to be exchanged).
+ The switch's port connected to the router is configured as an 802.1q trunk, carrying trafic for multiple VLANs.
+ The router's physical interface is divided into virtual sub-interfaces, each assigned an IP address and configured to handle traffic for a specific VLAN, acting as the default gateway for devices in that VLAN.
+ IEEE 802.1Q - a networking standard that supports VLANs on an IEEE 802.3 Ethernet network.
+ [Cisco Press: Router-on-a-Stick Inter-VLAN](https://www.ciscopress.com/articles/article.asp?p=3089357&seqNum=5)
+ [Cisco Press: Troubleshooting VLANs](https://www.ciscopress.com/articles/article.asp?p=3089357&seqNum=7)


## Tasks
1. Create VLAN topology in Packet Tracer & Basic Router/Switch/Endpoint Configuration.
2. Config VLANs and assign VIDs to the switchports per VLAN.
3. Config trunk on link between switch and router.
4. Config IP addresses to the PC per subnet (and config default gateway - using first IP, e.g. IT VLAN 20 10.10.2.0/24 - Gateway 10.10.2.1).
5. Try ping hosts on different VLANs (it should not work).
6. Config sub-interfaces on the router, bind each to its VLAN, & assign IP address of the subnet.
7. Ensure the IP address of each sub-interface is the default gateway of each VLAN subnet.
8. Try to ping hosts in different VLANs (it should now work).


### Task 1 + 4 - Basic Switch, Router, & Endpoint Config

**Switch 0**
! Basic Config
conf t
hostname SW0
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
enable password cisco123
service password-encryption
no ip domain-lookup
ip domain-name cisco.com

do wr

**Router 0**
! Router Config
conf t
hostname R0
enable password cisco123
service password-encryption
ban motd ^Unauthorised Access is Prohibited. All Activity is Logged.^
ip domain-name cisco.com
username admin password password123
int g0/0
description Link to User LAN
ip add 10.10.1.1 255.255.255.0
no sh
exit

! Config SSH Access
! Enable SSH with 1024-bit keys, set domain (for key generation), and force SSHv2
! Timeout authentication process (default 120)
crypto key generate rsa general-keys modulus 1024 
ip ssh version 2 
ip ssh time-out 60

! Config VTY SSH Access
line vty 0 15
! Specify authentication based on local db
login local
! Only permit SSH (no Telnet)
transport input ssh
exit

! Create Standard Numbered ACL list to allow IT Admin PC
access-list 10 permit host 10.10.2.3
access-list 10 deny any
! Bind the ACL to VTY 
line vty 0 15
! Allow incoming traffic on access-list 10
access-class 10 in
exit

do wr


### Task 2 - Config VLANs and Interfaces

ROAS Link - RO:G0/0 SW:G0/1
VLAN 20 - IT Admin:f0/7
VLAN 30 - FIN-1:f0/1 FIN-2:f0/2
VLAN 40 - HR-1:f0/3 HR-2:f0/4
VLAN 50 - PR-1:f0/5 PR-2:f0/6

**Switch 0**
vlan 10
name MGT
exit
vlan 20
name IT
exit
vlan 30
name FIN
exit
vlan 40
name HR
exit
vlan 50
name PR
exit
vlan 999
name blackhole
exit

do sh vlan

do wr

!Configure Ports on Switch0
int range f0/1-2
switchport mode access
switchport access vlan 30
exit
int range f0/3-4
switchport mode access
switchport access vlan 40
exit
int range f0/5-6
switchport mode access
switchport access vlan 50
exit
int range f0/7
switchport mode access
switchport access vlan 20
exit
! Secure Unused Ports
int range f0/8-24, g0/2
switchport mode access
switchport access vlan 999
shutdown
exit
do sh vlan

do wr


### Task 3 - Config Trunk (Router-Switch)
**Switch 0**
int g0/1
switchport mode trunk

! Security - Deny VLAN 999 on trunk link
switchport trunk allowed vlan except 999
exit
exit
sh int trunk

do wr

! Additional Security - Port Security
int range f0/1-7
switchport port-security
switchport port-security maximum 1
! Define the mac address permitted to access the port/interface
switchport port-security mac-address sticky
switchport port-security violation restrict
exit

do sh port-security

do wr

### Task 5 - Inter-VLAN Ping
+ Ping fails for inter-vlans.


### Task 6 + 7 - Config Router Sub-Interfaces & Gateway for Inter-VLAN Routing
**Router 0**
! MGT VLAN 10 & Gateway Bind
int g0/0.10
encapsulation dot1Q 10
ip add 10.10.1.1 255.255.255.0
exit

! IT VLAN 20 & Gateway Bind
int g0/0.20
encapsulation dot1Q 20
ip add 10.10.2.1 255.255.255.0
exit

! FIN VLAN 30 & Gateway Bind
int g0/0.30
encapsulation dot1Q 30
ip add 10.10.3.1 255.255.255.0
exit

! HR VLAN 40 & Gateway Bind
int g0/0.40
encapsulation dot1Q 40
ip add 10.10.4.1 255.255.255.0
exit

! PR VLAN 50 & Gateway Bind
int g0/0.50
encapsulation dot1Q 50
ip add 10.10.5.1 255.255.255.0
exit


### Task 8 - Inter-VLAN Ping
+ Ping succeeds for inter-vlans.
